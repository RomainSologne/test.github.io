roid<html>
  
<head>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <script src="https://cdn.maptiler.com/maplibre-gl-js/v1.13.0-rc.4/mapbox-gl.js"></script>
  <link href="https://cdn.maptiler.com/maplibre-gl-js/v1.13.0-rc.4/mapbox-gl.css" rel="stylesheet" />

  <style>
#map {position: absolute; top: 0; right: 0; bottom: 0; left: 0;}  
    
.Mypopup .mapboxgl-popup-content {
	background-color: black;
	color : white;
	opacity : 0.7;
}

.heading {
        position: absolute;
        top: 17px;
        left: 17px;
        padding: 15px;
        border-radius: 6px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        background: #FFFFFF;
        color: black;
}

.heading__title {
        font-size: 18px;
        font-weight: 600;
        margin: 0;
        padding: 0;
}

.heading__subtitle {
        font-size: 13px;
        font-weight: 600;
        margin: 2px 0 0 0;
        padding: 0;
}

.heading__small {
        display: inline-block;
        font-size: 12px;
        margin: 8px 0 0 0;
        text-decoration: none;
        border-bottom: 1px dashed black;
        color: black;
        padding: 0;
}

.heading__tiny {
        font-size: 9px;
        margin: 10px 0 0 0;
        padding: 0;
}
      
.logo {
	position: absolute;
	bottom: 17px;
	right: 17px;
        max-width: 200px;
        height: auto;
}
        
.logo-link {
        text-decoration: none; /* Supprime le soulignement du lien */
}
    
  </style>

  </head>

  <body> 
    
  <div id="map"></div>
	  
  <div class="logo">
         <a href="https://inegalites.fr/" target="_blank" class="logo-link">
            <img src="https://inegalites.fr/local/cache-vignettes/L300xH89/siteon0-b9b71.png?1657618760" alt="Logo de l'entreprise" class="logo">
         </a>
    </div>

 <div class="heading">
      <p class="heading__title" style="color: #3168af; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); font-size: 24px;">Cartographie 3d de la pauvreté en Indre-et-Loire</p>
      <p class="heading__subtitle">Part de ménages pauvres dans un carré de 200m, à partir des données carroyées de l'INSEE</p>
      <em class="heading__subtitle">(La taille des figurés représente le nombre total de ménages dans un carré)</em>
      <a class="heading__small" href="https://www.insee.fr/fr/statistiques/6215168?sommaire=6215217" target="_blank">Accès aux données</a>
      <p class="heading__tiny">Copyright © 2024 Romain THOMAS</p>
    </div>

<script>
   
      //Appel et configuration de la carte
    
var map = new mapboxgl.Map({
  container: 'map',
  style: 'https://openmaptiles.geo.data.gouv.fr/styles/osm-bright/style.json', //Fond de carte 
  zoom: 15.3, // Zoom
  center: [2.333333, 48.866667],  // Centrage carte
  pitch: 60, // Inclinaison carte
  bearing: -50,  // Rotation carte
  minZoom:10
    });
    
  // Ajout des données
      
map.on('load', function () {   
   //BATIMENTS 

map.addSource('Paris', {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/RomainSologne/test.github.io/main/Paris.geojson'
    });
 
map.addLayer({
    'id': 'Paris',
    'type': 'fill-extrusion',
    'source': 'Paris',
	'paint': 
	{'fill-extrusion-color': '#A9A9A9', 
        'fill-extrusion-height':{'type': 'identity','property': 'Men'},
        'fill-extrusion-color': {
        'property': 'Men_pauv',
        'stops': [
          [5, '#1a9850'],
          [7, '#91cf60'],
          [9, '#d9ef8b'],
          [12, '#ffffbf'],
      	  [16, '#fee08b'],
	  [20, '#fc8d59'],
          [30, '#d73027']]},
	 'fill-extrusion-opacity': 0.7,
         'fill-extrusion-base': 0}
    });
   
     // Ajout lignes de metros
  
     map.addSource('lignes', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/mastersigat/data/main/metro-du-reseau-star-traces-de-laxe-des-lignes.geojson'
        });

     map.addLayer({
            'id': 'Lignes',
            'type': 'line',
            'source': 'lignes',
            'paint': {'line-opacity': 0.7, 'line-width': 7,
                     'line-color': '#0074D9'}
     });   
   
     // Ajout stations de metros
  
  map.addSource('Stations', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/mastersigat/data/main/metro-du-reseau-star-localisation-des-stations.geojson'
        });

     map.addLayer({
            'id': 'Stations',
            'type': 'circle',
            'source': 'Stations',
            'paint': {'circle-stroke-color': 'white', 
                      'circle-stroke-width': 3, 
                      'circle-radius' : 6,
                      'circle-color': '#0074D9'}}
                 );  
         });
  
  
// Fonction pour calculer le centroid d'un polygone
function getCentroid(coordinates) {
    const [firstRing] = coordinates; // Prend le premier anneau du polygone
    let x = 0;
    let y = 0;
    for (let i = 0; i < firstRing.length; i++) {
        x += firstRing[i][0];
        y += firstRing[i][1];
    }
    return [x / firstRing.length, y / firstRing.length]; // Retourne les coordonnées du centroid
}

// Initialisation du popup
var popup = new mapboxgl.Popup({
    className: "Mypopup",
    closeButton: false,
    closeOnClick: false 
});

// Écouteur d'événements pour la souris
map.on('mousemove', function(e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['Paris'] });
    // Change le style du curseur comme indicateur d'interface utilisateur.
    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
        popup.remove();
        return; 
    }
 
    var feature = features[0];
    const centroid = getCentroid(feature.geometry.coordinates);
    popup.setLngLat(centroid) // Utilisez le centroid calculé
        .setHTML('<b>' + feature.properties.Men_pauv + '</b>')
        .addTo(map);
});
	
  // Configuration affichage menu couches
 switchlayer = function (lname) {
            if (document.getElementById(lname ).checked) {
                map.setLayoutProperty(lname, 'visibility', 'visible');
            } else {
                map.setLayoutProperty(lname, 'visibility', 'none');
           }
        };
  
	
    // Ajout controle de navigation et echelle 
  
map.addControl(new mapboxgl.NavigationControl({position: 'top-left'}));  
  
map.addControl(new mapboxgl.ScaleControl({position: 'bottom-right'}));
  
  
</script>
    
</body>
</html>
